# SVF Report Transformer (SRT)

## 文件目录

```text
--
|- in.json 示例输入。这是使用SVF对apache httpd-2.4.23静态分析生成的报告
|- out.json 示例输出。这是使用SRT对in.json在默认运行参数下处理的结果。得到此结果需要将httpd-2.4.23的源码复制到目录下
|- SRT.py SVF Report Transformer 用于生成便于使用大模型辅助静态分析的中间格式
```

## 功能

使用合适的运行参数运行`SRT.py`，可以在有源代码的情况下将给定的SVF内存泄露分析报告进行内容扩充，使其包含可疑变量名，可疑部分代码等必要的诊断信息。
同时可以将SVF的内存泄露分析报告同其他静态分析模型生成的报告综合起来，便于设计统一的prompt来借助大模型辅助静态分析。

具体而言，对于已有的SVF报告，做以下工作:
1. 保留现有的所有信息
2. 将文件名转换为文件实际的绝对路径（因为SVF提供的报告中只能指出文件名，不便于定位实际的位置）
3. 从缺陷警告位置推断可能的变量名
4. 将缺陷附近的代码摘录，如果类型为Partial Leak，会同时摘录分支判断条件
5. 为每一条警报添加标签，反映其是否正确地被处理并生成中间格式

## 运行参数

| 运行参数       | 类型   | 描述                                                         | 默认值     |
| -------------- | ------ | ------------------------------------------------------------ | ---------- |
| `input_file`   | String | 输入JSON文件                                                 | "in.json"  |
| `output_file`  | String | 输出JSON文件                                                 | "out.json" |
| `root_dir`     | String | 项目源代码所在目录                                           | "./"       |
| `copy_range`   | Int    | 可疑代码附近的拷贝行数 >= 0                                  | 1          |
| `cap_not_name` | Bool   | 在推断可疑变量名时，忽略纯大写字母名称，因为其可能是常量或者是宏 | True       |

SRT在运行会输出类似下图的日志。

![截屏2024-01-17 23.16.29](/Users/jinwenze/Coding/SVF/SRT/README.assets/截屏2024-01-17 23.16.29.png)
